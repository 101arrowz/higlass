<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HiGlass</title>
<style type="text/css">
    .canvasjs-chart-credit {
    display:none;

    .wp-caption: {

    };
}
</style>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="hglib.css">

    <script crossorigin src="react.development.js"></script>
    <script crossorigin src="react-dom.development.js"></script>
    <script src="pixi.min.js"></script>
    <script src="react-bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>


</head>
<body >
  <div style="display: flex">
    <div id="development-demo" style="width: 50%; background-color: lightgreen;"></div>
    <div id="info-panel">
      <span>X position:</span> <input id='x-position' type='text' /><br>
      <span>Y position:</span> <input id='y-position' /><br>
      <textarea id="description" rows="5"></textarea><br>
      <button id="save-button" style="visibility: hidden">Save</button><br>
    </div>
</body>
<script src='hglib.js'>
</script>
<script>

 var baseConf =
{
  "trackSourceServers": [
    "http://higlass.io/api/v1"
  ],
  "editable": true,
  "views": [
    {
      "tracks": {
        "center": [],
        "left": [],
        "right": [],
        "top": [
          {
            "type": "top-axis",
            "local": true,
            "orientation": "1d-horizontal",
            "name": "Top Axis",
            "thumbnail": {},
            "defaultOptions": {},
            "server": "",
            "tilesetUid": "MR07RHs9TmSkxJhNyyjqsA",
            "uid": "HeBuceBRQRymQUPMjfqxtg",
            "options": {},
            "width": 368,
            "height": 20,
            "position": "top"
          },
          {
            "name": "wgEncodeLicrTfbsLiverPol2MAdult8wksC57bl6StdSig.hitile",
            "created": "2017-11-02T15:49:44.323124Z",
            "server": "http://higlass.io/api/v1",
            "tilesetUid": "CBNmltxlSOeQWKeoCfQT1g",
            "uid": "HHMDFX8US1SvZZZBs3AM6g",
            "type": "horizontal-line",
            "options": {
              "labelColor": "black",
              "labelPosition": "topLeft",
              "axisLabelFormatting": "scientific",
              "axisPositionHorizontal": "right",
              "lineStrokeColor": "blue",
              "lineStrokeWidth": 1,
              "valueScaling": "linear",
              "trackBorderWidth": 0,
              "trackBorderColor": "black",
              "labelTextOpacity": 0.4,
              "showMousePosition": false,
              "mousePositionColor": "#999999",
              "showTooltip": false,
              "name": "wgEncodeLicrTfbsLiverPol2MAdult8wksC57bl6StdSig.hitile"
            },
            "width": 368,
            "height": 20,
            "position": "top"
          },
          {
            "type": "combined",
            "uid": "dblx2SinQMyhX7JUMTcTvg",
            "height": 80,
            "width": 368,
            "contents": [
              {
                "name": "Gene Annotations (hg19)",
                "created": "2017-02-05T19:31:52.412319Z",
                "server": "http://higlass.io/api/v1",
                "tilesetUid": "OHJakQICQD6gTD7skx4EWA",
                "uid": "DG9NQvdkTIGSBAthThLIWQ",
                "type": "horizontal-gene-annotations",
                "options": {
                  "fontSize": 11,
                  "labelColor": "black",
                  "labelPosition": "hidden",
                  "plusStrandColor": "blue",
                  "minusStrandColor": "red",
                  "trackBorderWidth": 0,
                  "trackBorderColor": "black",
                  "showMousePosition": false,
                  "mousePositionColor": "#999999",
                  "geneAnnotationHeight": 10,
                  "geneLabelPosition": "outside",
                  "geneStrandSpacing": 4,
                  "name": "Gene Annotations (hg19)"
                },
                "width": 368,
                "height": 80,
                "header": "",
                "position": "top"
              },
              {
                "uid": "HFzY1uJ1QEekb_Kg8EkbVw",
                "type": "selection-track-horizontal",
                "options": {
                  "projectionFillColor": "#777",
                  "projectionStrokeColor": "#F00",
                  "projectionFillOpacity": 0.3,
                  "projectionStrokeOpacity": 0.7,
                  "strokeWidth": 1,
                  "fillColor": "#777",
                  "strokeColor": "#777",
                  "fillOpacity": 0.3,
                  "strokeOpacity": 0.7,
                  "savedRegions": [
                    [
                      [
                        1346033021.5886,
                        1393263522.5946486
                      ],
                      null
                    ]
                  ]
                },
                "position": "top",
                "name": "Horizontal selection",
                "width": 368,
                "height": 80
              }
            ],
            "position": "top",
            "options": {}
          }
        ],
        "bottom": [],
        "whole": [],
        "gallery": []
      },
      "uid": "EhlO1fwhSuyCliHSEzygnA",
      "initialXDomain": [
        1221442217.210575,
        1525183197.8184395
      ],
      "initialYDomain": [
        1386291410.843911,
        1376519583.049556
      ],
      "layout": {
        "w": 12,
        "h": 4,
        "x": 0,
        "y": 0,
        "i": "EhlO1fwhSuyCliHSEzygnA",
        "moved": false,
        "static": false
      }
    }
  ],
  "zoomLocks": {
    "locksByViewUid": {},
    "locksDict": {}
  },
  "locationLocks": {
    "locksByViewUid": {},
    "locksDict": {}
  },
  "valueScaleLocks": {
    "locksByViewUid": {},
    "locksDict": {}
  },
  "selectionLocks": {
    "locksByViewUid": {},
    "locksDict": {}
  }
}

    let hgv = hglib.viewer(
        document.getElementById('development-demo'),
        baseConf,
        {
          bounded: false,
          rangeSelectionOnAlt: true,
        }
    );

let currentRange = null;

const rangeListenerId = hgv.on(
  'rangeSelection',
  range => {
    console.log('dataRange:', range.dataRange);
    currentRange = range.dataRange;

    const minValue = Math.min(
      range.dataRange[0] && +range.dataRange[0][0],
      range.dataRange[0] && +range.dataRange[0][1]
    )
    const maxValue = Math.max(
      range.dataRange[0] && +range.dataRange[0][0],
      range.dataRange[0] && +range.dataRange[0][1]
    )

    if (!range.dataRange[0]) {
      d3.select('#save-button')
      .style('visibility', 'hidden');
    } else {
      d3.select('#save-button')
      .style('visibility', 'visible');
    }
    d3.select('#x-position')
    .property('value', minValue);
    d3.select('#y-position')
    .property('value', maxValue);
  }
);

d3.select('#save-button')
.on('click', () => {
  const viewconf = hgv.getViewConfig();
  const track = viewconf.views[0].tracks.top[2].contents[1];

  if (!track.options.savedRegions) {
    track.options.savedRegions = [currentRange];
  } else {
    track.options.savedRegions += [currentRange];
  }

  hgv.setViewConfig(viewconf);
})
   // window.hgApi.getComponent().tiledPlots.aa.handleAddTrack('top');

 // window.hgApi.activateTool('select-limited');

</script>
</html>
